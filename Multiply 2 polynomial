#include <stdio.h>
#include <stdlib.h>

struct node {
    int co, po;
    struct node *addr;
};
typedef struct node *NODE;

// Function to insert term at end
NODE insertend(NODE start, int co, int po) {
    NODE temp, cur;
    temp = (NODE)malloc(sizeof(struct node));
    temp->co = co;
    temp->po = po;
    temp->addr = NULL;

    if (start == NULL)
        return temp;

    cur = start;
    while (cur->addr != NULL)
        cur = cur->addr;

    cur->addr = temp;
    return start;
}

// Display polynomial
void display(NODE start) {
    NODE temp;
    if (start == NULL) {
        printf("Polynomial is empty\n");
        return;
    }

    temp = start;
    while (temp->addr != NULL) {
        printf("%dx^%d + ", temp->co, temp->po);
        temp = temp->addr;
    }
    printf("%dx^%d\n", temp->co, temp->po);
}

// Add term inside result polynomial (combine like terms)
NODE additem(NODE res, int co, int po) {
    NODE temp, cur;
    
    temp = (NODE)malloc(sizeof(struct node));
    temp->co = co;
    temp->po = po;
    temp->addr = NULL;

    if (res == NULL)
        return temp;

    cur = res;
    while (cur != NULL) {
        if (cur->po == po) {
            cur->co = cur->co + co;  // combine like terms
            return res;
        }
        cur = cur->addr;
    }

    // If no same exponent found, insert at end
    res = insertend(res, co, po);
    return res;
}

// Multiply two polynomials
NODE multiply(NODE poly1, NODE poly2) {
    NODE p1, p2;
    NODE result = NULL;

    for (p1 = poly1; p1 != NULL; p1 = p1->addr) {
        for (p2 = poly2; p2 != NULL; p2 = p2->addr) {
            int co = p1->co * p2->co;
            int po = p1->po + p2->po;
            result = additem(result, co, po);
        }
    }

    return result;
}

int main() {
    NODE poly1 = NULL, poly2 = NULL, poly;
    int n, i, co, po;

    // Read first polynomial
    printf("Enter number of terms of first polynomial: ");
    scanf("%d", &n);

    for (i = 1; i <= n; i++) {
        printf("Enter coefficient and power of term %d: ", i);
        scanf("%d %d", &co, &po);
        poly1 = insertend(poly1, co, po);
    }

    printf("First polynomial is:\n");
    display(poly1);

    // Read second polynomial
    printf("\nEnter number of terms of second polynomial: ");
    scanf("%d", &n);

    for (i = 1; i <= n; i++) {
        printf("Enter coefficient and power of term %d: ", i);
        scanf("%d %d", &co, &po);
        poly2 = insertend(poly2, co, po);
    }

    printf("Second polynomial is:\n");
    display(poly2);

    // Multiply polynomials
    poly = multiply(poly1, poly2);

    printf("\nResultant polynomial is:\n");
    display(poly);

    return 0;
}
